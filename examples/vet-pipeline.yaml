apiVersion: dataflow.argoproj.io/v1alpha1
kind: Pipeline
metadata:
  annotations:
    dataflow.argoproj.io/description: |
      This pipeline process pets (cats and dogs).
    dataflow.argoproj.io/name: Vetinary
  creationTimestamp: null
  name: vet
spec:
  nodes:
  - args:
    - sh
    - -c
    - |
      cat /in/text | tee /var/run/argo-dataflow/out
      sleep 999
    image: debian:10.7-slim
    imagePullPolicy: IfNotPresent
    name: read-pets
    out:
      fifo: true
    resources: {}
    sinks:
    - nats:
        subject: animals
    volumeMounts:
    - mountPath: /in
      name: in
    volumes:
    - configMap:
        name: pets
      name: in
  - args:
    - sh
    - -c
    - |
      cat /var/run/argo-dataflow/in | grep cat | tee /var/run/argo-dataflow/out
    image: debian:10.7-slim
    imagePullPolicy: IfNotPresent
    in:
      fifo: true
    name: filter-cats
    out:
      fifo: true
    resources: {}
    sinks:
    - nats:
        subject: cats
    sources:
    - {}
  - args:
    - sh
    - -c
    - |
      cat /var/run/argo-dataflow/in | tee /var/run/argo-dataflow/out
    image: debian:10.7-slim
    imagePullPolicy: IfNotPresent
    in:
      fifo: true
    name: process-cats
    out:
      fifo: true
    resources: {}
    sinks:
    - kafka:
        topic: output-topic
    sources:
    - {}
  - args:
    - sh
    - -c
    - |
      cat /var/run/argo-dataflow/in | grep dog > /var/run/argo-dataflow/out
    image: debian:10.7-slim
    imagePullPolicy: IfNotPresent
    in:
      fifo: true
    name: filter-dogs
    out:
      fifo: true
    resources: {}
    sinks:
    - nats:
        subject: dogs
    sources:
    - {}
  - args:
    - sh
    - -c
    - |
      cat /var/run/argo-dataflow/in | tee /var/run/argo-dataflow/out
    image: debian:10.7-slim
    imagePullPolicy: IfNotPresent
    in:
      fifo: true
    name: process-dogs
    out:
      fifo: true
    resources: {}
    sinks:
    - kafka:
        topic: output-topic
    sources:
    - {}
