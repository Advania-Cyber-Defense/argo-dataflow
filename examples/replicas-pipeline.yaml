apiVersion: dataflow.argoproj.io/v1alpha1
kind: Pipeline
metadata:
  name: replicas
  annotations:
    dataflow.argoproj.io/name: Using replicas to scale
    dataflow.argoproj.io/description: |
      This example shows a example of having multiple replicas of a single node.

      As each node correspondes to a deployment, this will be the number of replicas (i.e. pods) for the deployment.

      The same message  will not be send to two different replicas.

      This allows you to scale up to process more messages.

      You can also use `kubectl scale replicas pipeline-${pipelineName}-${nodeName} --replicas 4`.
spec:
  nodes:
    - name: main
      sources:
        - kafka:
            url: kafka-0.broker.kafka.svc.cluster.local:9092
            topic: input-topic
      in:
        http: { }
      image: argoproj/dataflow-cat:latest
      imagePullPolicy: IfNotPresent
      replicas:
        value: 4
      out:
        http: { }
      sinks:
        - kafka:
            url: kafka-0.broker.kafka.svc.cluster.local:9092
            topic: output-topic
